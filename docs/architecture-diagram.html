<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mentory - Diagrama de Arquitectura</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f8f9fa;
            color: #2d3748;
            margin: 0;
            padding: 60px 20px;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #1a202c;
            margin-bottom: 8px;
            font-weight: 700;
            font-size: 2.5rem;
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            font-weight: 400;
            margin-top: 0;
            margin-bottom: 50px;
            font-size: 1.1rem;
        }
        
        .diagram-container {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 50px 40px;
            margin: 0 auto 50px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 4px 12px rgba(0, 0, 0, 0.03);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .diagram-container .mermaid {
            display: flex;
            justify-content: center;
            width: 100%;
        }
        
        .diagram-container .mermaid svg {
            max-width: 100%;
            height: auto;
        }
        
        .section-title {
            color: #1a202c;
            text-align: center;
            margin: 50px 0 25px;
            font-weight: 600;
            font-size: 1.5rem;
        }
        
        .table-container {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 4px 12px rgba(0, 0, 0, 0.03);
            overflow-x: auto;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .tech-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .tech-table th {
            padding: 14px 20px;
            text-align: left;
            background: #f7fafc;
            color: #4a5568;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .tech-table th:first-child {
            border-radius: 8px 0 0 0;
        }
        
        .tech-table th:last-child {
            border-radius: 0 8px 0 0;
        }
        
        .tech-table td {
            padding: 14px 20px;
            text-align: left;
            border-bottom: 1px solid #edf2f7;
            color: #2d3748;
        }
        
        .tech-table tr:last-child td {
            border-bottom: none;
        }
        
        .tech-table tr:hover td {
            background: #f7fafc;
        }
        
        .tech-table td:first-child {
            font-weight: 500;
            color: #4a5568;
        }
        
        .tech-table td:last-child {
            font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            color: #5a67d8;
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding-bottom: 20px;
            color: #a0aec0;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mentory</h1>
        <p class="subtitle">Arquitectura del Sistema</p>

        <div class="diagram-container">
            <pre class="mermaid">
%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e2e8f0', 'primaryTextColor': '#1a202c', 'primaryBorderColor': '#cbd5e0', 'lineColor': '#718096', 'secondaryColor': '#f7fafc', 'tertiaryColor': '#edf2f7', 'fontSize': '14px', 'fontFamily': 'Inter'}}}%%
flowchart LR
    subgraph Cliente["CLIENTE"]
        Browser["<i>Navegador Web</i>"]
    end

    subgraph Frontend["FRONTEND"]
        FE_Stack["<b>React</b> + <b>TypeScript</b>
        <i>Vite</i>
        <i>Axios</i>"]
    end

    subgraph Backend["BACKEND"]
        BE_Stack["<b>Spring Boot</b>
        <i>Spring Security</i>
        <i>Spring Data JPA</i>
        <b>JWT</b> + <b>RSA</b>"]
    end

    subgraph Persistencia["PERSISTENCIA"]
        PostgreSQL["<b>PostgreSQL</b>
        <i>Datos principales</i>"]
        Redis["<b>Redis</b>
        <i>Tokens de sesion</i>"]
    end

    subgraph Infra["INFRAESTRUCTURA"]
        Docker["<b>Docker Compose</b>"]
    end

    Cliente -->|HTTP| Frontend
    Frontend -->|REST API| Backend
    Backend -->|JDBC| PostgreSQL
    Backend -->|Redis Protocol| Redis
    Infra -.->|Contenedores| Persistencia
            </pre>
        </div>

        <h3 class="section-title">Stack Tecnologico</h3>
        
        <div class="table-container">
            <table class="tech-table">
                <thead>
                    <tr>
                        <th>Capa</th>
                        <th>Tecnologia</th>
                        <th>Version</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Frontend</td><td>React + TypeScript</td><td>18.2.0 / 5.2.2</td></tr>
                    <tr><td>Build Tool</td><td>Vite</td><td>7.3.0</td></tr>
                    <tr><td>HTTP Client</td><td>Axios</td><td>1.6.2</td></tr>
                    <tr><td>Routing</td><td>React Router DOM</td><td>6.21.0</td></tr>
                    <tr><td>Backend</td><td>Spring Boot</td><td>4.0.0-SNAPSHOT</td></tr>
                    <tr><td>Java</td><td>JDK</td><td>25</td></tr>
                    <tr><td>Seguridad</td><td>Spring Security + JWT</td><td>7.0.0 / 0.12.5</td></tr>
                    <tr><td>ORM</td><td>Hibernate (JPA)</td><td>-</td></tr>
                    <tr><td>API Docs</td><td>SpringDoc OpenAPI</td><td>3.0.0-RC1</td></tr>
                    <tr><td>Base de Datos</td><td>PostgreSQL</td><td>16</td></tr>
                    <tr><td>Cache</td><td>Redis</td><td>7</td></tr>
                    <tr><td>Contenedores</td><td>Docker Compose</td><td>3.9</td></tr>
                </tbody>
            </table>
        </div>

        <h3 class="section-title">Flujo de Autenticacion</h3>
        
        <div class="diagram-container">
            <pre class="mermaid">
%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e2e8f0', 'primaryTextColor': '#1a202c', 'primaryBorderColor': '#cbd5e0', 'lineColor': '#718096', 'secondaryColor': '#f7fafc', 'tertiaryColor': '#edf2f7', 'fontSize': '13px', 'fontFamily': 'Inter'}}}%%
sequenceDiagram
    participant C as Cliente
    participant F as Frontend
    participant B as Backend
    participant P as PostgreSQL
    participant R as Redis

    Note over C,R: LOGIN
    C->>F: Usuario y password
    F->>B: POST /auth/login
    B->>P: Validar credenciales
    P-->>B: Usuario valido
    B->>R: Guardar refresh token (72h TTL)
    B-->>F: JWT (header) + Refresh Token (cookie HttpOnly)
    F->>F: Guardar JWT en memoria
    F-->>C: Login exitoso

    Note over C,R: PETICION PROTEGIDA
    C->>F: Accion del usuario
    F->>B: Request + JWT (Authorization header)
    B->>B: Validar JWT (firma RSA)
    B-->>F: Respuesta
    F-->>C: Datos

    Note over C,R: JWT EXPIRADO (15 min)
    C->>F: Accion del usuario
    F->>B: Request + JWT expirado
    B-->>F: 401 Unauthorized
    F->>B: POST /auth/refresh (cookie auto-enviada)
    B->>R: Validar refresh token
    R-->>B: Token valido
    B->>R: Rotar refresh token (nuevo token)
    B-->>F: Nuevo JWT + Nueva cookie
    F->>F: Actualizar JWT en memoria
    F->>B: Reintentar request original
    B-->>F: Respuesta
    F-->>C: Datos

    Note over C,R: LOGOUT
    C->>F: Cerrar sesion
    F->>B: POST /auth/logout
    B->>R: Eliminar refresh token
    B-->>F: Cookie eliminada (maxAge=0)
    F->>F: Borrar JWT de memoria
    F-->>C: Redirigir a login
            </pre>
        </div>
        
        <p class="footer">Mentory - Plataforma de Aprendizaje</p>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis',
                padding: 20
            }
        });
    </script>
</body>
</html>
